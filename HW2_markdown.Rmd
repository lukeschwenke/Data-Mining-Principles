---
title: "Boston Cluster Analysis"
author: "Luke Schwenke, Soheb Osmani, Ken Ma"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
---

## Load Data and Packages

```{r data, echo=TRUE, warning=FALSE}

library(MASS)
library(dplyr)
library(ggplot2)
library(mclust)
boston_data <- Boston

```

## Split data into Train/Test Sets

```{r train and test, echo=TRUE, warning=FALSE}

boston_data$id <- 1:nrow(boston_data)
train <- boston_data %>% dplyr::sample_frac(0.7)
test <- dplyr::anti_join(boston_data, train, by = 'id')
train$id <- NULL
test$id <- NULL

train %>% head(5)

```

## Scaling the Test Set using Training Set Mean and Std. Dev.

### Calculate the mean and standard deviation for each column in the training set

```{r train means, echo=TRUE, warning=FALSE}

train_mean <- apply(train, 2, mean) #apply mean calculation to each column (2)
train_sd <- apply(train, 2, sd)     #apply std. dev. calculation to each column (2)
train_scale <- scale(train, center=train_mean, scale=train_sd) # scale train based on the calculated values
test_scale <- scale(test, center=train_mean, scale=train_sd)   # scale test based on the calculated values

```

## Generate K-means Clustering Solution

kmeans(x, centers, iter.max, nstart)
x = numeric matrix of data
centers = number of clusters, k
iter.max = maximum iterations allowed (default 10)
nstart = number of random sets that should be chosen

```{r k-means clustering, echo=TRUE, warning=FALSE}

# Initialize empty list with vectors to capture the rsq value and summations
results <- list()
results[["rsq"]] <- vector(mode = "numeric", length = length(2:20))
results[["sumwithinss"]] <- vector(mode = "numeric", length = length(2:20))

# Iterate through 2 up to 20 cluster groups for 100 random starts
for (i in 2:20) {
  result <- kmeans(train_scale, 
                   centers = i,
                   iter.max = 20,
                   nstart = 100)
  
  # For each cluster, calculate the following, insert starting at 1 of the result list
  results[["sumwithinss"]][i-1] <- sum(result$withinss)           # sum of squares in a cluster
  results[["rsq"]][i-1] <- result$betweenss / result$totss        # between-cluster sum of squares / total sum of squares
  results[["centers"]][[paste0("cluster_",i)]] <- result$centers  # cluster means
  results[["centsizeers"]][[paste0("cluster_",i)]] <- result$size # observations in each cluster
}

# kmeans() function returns a list of components, including:
# cluster: A vector of integers (from 1:k) indicating the cluster to which each point is allocated
# centers: A matrix of cluster centers (cluster means)
# totss: The total sum of squares (TSS), i.e ∑(xi−x¯)2
# . TSS measures the total variance in the data.
# withinss: Vector of within-cluster sum of squares, one component per cluster
# tot.withinss: Total within-cluster sum of squares, i.e. sum(withinss)
# betweenss: The between-cluster sum of squares, i.e. totss−tot.withinss
# size: The number of observations in each cluster

```


## Plot R-squared values for the Clusters & Scree Plot (finding best k)

``` {r plots, echo=TRUE, warning=FALSE}

plot(2:20, results[["rsq"]], type="b", xlab="Number of clusters",
     ylab="R-square", main = "R-square for 2-20 clusters")

plot(2:20, results[["sumwithinss"]], type="b", xlab="Number of clusters",
     ylab="Within groups sum of squares", main = "Elbow Curve")


```
## Set optimal k-means at 10 Clusters (k) and run on Test set

``` {r optimum, echo=TRUE, warning=FALSE}

optimaltrain <- kmeans(train_scale, centers = 10, nstart = 100)

# Use the centers (means) generated from the training set optimum
testresult <- kmeans(test_scale, centers = optimaltrain$centers, nstart = 100)

```

## Examine Size, VAF, and Centroids for Train and Test Sets at the best K
``` {r VAF, echo=TRUE, warning=FALSE}

# Cluster Sizes for Train and Test
sizes <- data.frame(cluster_size_train = results$centsizeers$cluster_10 / sum(results$centsizeers$cluster_10),
                    cluster_size_test = testresult$size / sum(testresult$size))
sizes

# VAF for Train and Test
vaf <- data.frame(vaf_train = optimaltrain$betweenss/optimaltrain$totss,
                  vaf_test = testresult$betweenss/testresult$totss)
vaf

# Centroids for Train and Test:
centroids <- data.frame(centroids_train = optimaltrain$centers, 
                        centroids_test = testresult$centers)
centroids

```
## Interpretation:
### TBD

# Gaussian Mixtures

``` {r Gaussian, echo=TRUE, warning=FALSE}

GMmodel <- mclust::Mclust(train_scale[,which(colnames(train_scale) %in% c("crim","dis"))], G = 3:5, modelNames = "VVI")

test_GMmodel <- mclust::Mclust(test_scale[,which(colnames(test_scale) %in% c("crim","dis"))], G = 5, modelNames = "VVI")


```





